# گلکسی کلاینت کامندز

گلکسی کلاینت کامندز یک برنامه سرور مبتنی بر PHP است که برای مدیریت و نظارت بر تعاملات کلاینت‌ها از طریق ربات تلگرام و داشبورد تحت وب طراحی شده است. این برنامه چارچوبی قدرتمند برای مدیریت دستورات کلاینت‌ها، ثبت فعالیت‌ها و مدیریت داده‌هایی مانند کلیدهای تایپ شده، اطلاعات سیستم، اسکرین‌شات‌ها، رمزهای وای‌فای و اتصالات RDP ارائه می‌دهد. این برنامه از پایگاه داده MySQL برای ذخیره‌سازی دائمی استفاده می‌کند و شامل رمزنگاری برای مدیریت امن داده‌ها است.

## فهرست مطالب
- [ویژگی‌ها](#ویژگی‌ها)
- [نیازمندی‌ها](#نیازمندی‌ها)
- [نصب](#نصب)
- [ساختار پروژه](#ساختار-پروژه)
- [پیکربندی](#پیکربندی)
- [نحوه استفاده](#نحوه-استفاده)
  - [تنظیم وب‌هوک](#تنظیم-وب‌هوک)
  - [دسترسی به داشبورد](#دسترسی-به-داشبورد)
  - [تعامل از طریق تلگرام](#تعامل-از-طریق-تلگرام)
- [ملاحظات امنیتی](#ملاحظات-امنیتی)
- [طرح پایگاه داده](#طرح-پایگاه-داده)
- [مشارکت](#مشارکت)
- [مجوز](#مجوز)

## ویژگی‌ها
- **ادغام با ربات تلگرام**: به کاربران ادمین امکان می‌دهد از طریق دستورات تلگرام با کلاینت‌ها تعامل کنند، شامل انتخاب کلاینت‌ها، صدور دستورات و دریافت به‌روزرسانی‌ها.
- **داشبورد تحت وب**: داشبوردی پاسخگو با استایل Tailwind CSS برای مشاهده لاگ‌های دستورات، داده‌های کلاینت، وضعیت تشخیص VM، رمزهای وای‌فای و جزئیات اتصالات RDP.
- **مدیریت دستورات**: پشتیبانی از دستورات متنوع کلاینت مانند بررسی وضعیت سیستم، گرفتن اسکرین‌شات، عملیات فایل و مدیریت RDP.
- **رمزنگاری داده‌ها**: استفاده از رمزنگاری AES-256-CBC برای ایمن‌سازی داده‌های حساس مانند کلیدهای تایپ شده، اطلاعات سیستم و نتایج دستورات.
- **مدیریت پایگاه داده**: ذخیره دستورات کلاینت، لاگ‌ها و داده‌های کاربر در پایگاه داده MySQL با طرحی مشخص.
- **بارگذاری خودکار**: پیاده‌سازی یک Autoloader سفارشی برای بارگذاری کارآمد کلاس‌ها در دایرکتوری `src`.
- **ثبت لاگ**: سیستم جامع ثبت لاگ برای خطاها، فعالیت‌های وب‌هوک و جزئیات اجرای دستورات.
- **راه‌اندازی دایرکتوری**: ایجاد خودکار دایرکتوری‌های مورد نیاز برای لاگ‌ها، اسکرین‌شات‌ها و آپلودها.

## نیازمندی‌ها
- **PHP**: نسخه 7.4 یا بالاتر
- **MySQL**: نسخه 5.7 یا بالاتر
- **وب سرور**: آپاچی یا Nginx
- **Composer**: برای مدیریت وابستگی‌ها (اختیاری، زیرا وابستگی‌ها حداقل هستند)
- **cURL**: افزونه PHP برای ارسال درخواست‌های HTTP
- **OpenSSL**: افزونه PHP برای رمزنگاری
- **PDO**: افزونه PHP برای اتصال به پایگاه داده MySQL
- **توکن ربات تلگرام**: قابل دریافت از BotFather در تلگرام
- **سرور با HTTPS**: برای ارتباطات امن وب‌هوک مورد نیاز است

## نصب
1. **کلون کردن مخزن**:
   ```bash
   git clone <repository-url>
   cd galaxy-client-commands
   ```

2. **تنظیم فایل محیط**:
   - یک فایل `.env` در ریشه پروژه ایجاد کنید.
   - متغیرهای محیط زیر را اضافه کنید:
     ```plaintext
     BASE_URL=https://your-domain.com
     BOT_TOKEN=your-telegram-bot-token
     WEBHOOK_SECRET=your-webhook-secret-token
     ADMIN_CHAT_ID=your-telegram-chat-id
     DB_HOST=localhost
     DB_NAME=logger
     DB_USER=your-db-user
     DB_PASS=your-db-password
     ```

3. **نصب وابستگی‌ها**:
   - اطمینان حاصل کنید که افزونه‌های PHP (`curl`, `openssl`, `pdo_mysql`) فعال هستند.
   - هیچ وابستگی خارجی Composer برای این پروژه لازم نیست.

4. **تنظیم پایگاه داده**:
   - یک پایگاه داده MySQL به نام `logger` (یا همان نامی که در `.env` مشخص شده) ایجاد کنید.
   - اسکریپت `database-installer/install-db.php` را برای راه‌اندازی طرح اجرا کنید:
     ```bash
     php database-installer/install-db.php
     ```

5. **پیکربندی وب سرور**:
   - وب سرور خود را به ریشه پروژه هدایت کنید.
   - اطمینان حاصل کنید که دایرکتوری‌های `viewer` و `webhook` قابل دسترسی هستند.
   - برای آپاچی، در صورت نیاز پشتیبانی از `.htaccess` را فعال کنید.
   - برای Nginx، قوانین بازنویسی مناسب برای مدیریت فایل‌های PHP را پیکربندی کنید.

6. **تنظیم مجوزهای دایرکتوری**:
   - اطمینان حاصل کنید که دایرکتوری‌های `log`, `screenshots`, و `uploads` توسط وب سرور قابل نوشتن هستند:
     ```bash
     chmod -R 755 log screenshots uploads
     ```

7. **تنظیم وب‌هوک تلگرام**:
   - اسکریپت `webhook/setWebhook.php` را برای پیکربندی وب‌هوک تلگرام اجرا کنید:
     ```bash
     php webhook/setWebhook.php
     ```

## ساختار پروژه
پروژه از ساختاری مدولار برای نگهداری و مقیاس‌پذیری استفاده می‌کند:

```
├── api.php                 # نقطه ورود اصلی API برای درخواست‌های کلاینت و وب‌هوک
├── config.php              # کلاس پیکربندی برای متغیرهای محیط
├── ip.php                  # ابزار برای دریافت آدرس IP کلاینت
├── load_env.php            # بارگذاری متغیرهای محیط از فایل .env
├── version.php             # ارائه اطلاعات نسخه و جزئیات به‌روزرسانی
├── database-installer/     # اسکریپت‌های راه‌اندازی پایگاه داده
│   ├── install-db.php      # راه‌اندازی طرح پایگاه داده و کاربر ادمین
│   └── schema.sql          # طرح SQL برای پایگاه داده logger
├── src/                    # منطق اصلی برنامه
│   ├── Autoloader.php      # Autoloader سفارشی برای کلاس‌های PHP
│   ├── Database/           # کلاس‌های مرتبط با پایگاه داده
│   │   └── DatabaseConnection.php
│   ├── Handlers/           # مدیریت‌کننده‌های درخواست و وب‌هوک
│   │   ├── CallbackQueryHandler.php
│   │   ├── ClientRequestHandler.php
│   │   └── WebhookHandler.php
│   ├── Services/           # کلاس‌های سرویس برای منطق کسب‌وکار
│   │   ├── ClientService.php
│   │   ├── EncryptionService.php
│   │   ├── LoggerService.php
│   │   └── TelegramService.php
│   └── Utils/              # کلاس‌های ابزار
│       └── DirectoryInitializer.php
├── viewer/                 # داشبورد تحت وب برای نمایش لاگ‌ها و داده‌ها
│   └── log-viewer.php
├── webhook/                # پیکربندی وب‌هوک
│   └── setWebhook.php
└── .env                    # فایل پیکربندی محیط (شامل نمی‌شود)
```

## پیکربندی
- **فایل .env**: شامل پیکربندی‌های حساس مانند اطلاعات پایگاه داده، توکن ربات تلگرام و رمز وب‌هوک. اطمینان حاصل کنید که این فایل به صورت عمومی قابل دسترسی نیست.
- **Config.php**: بارگذاری پیکربندی‌ها را متمرکز کرده و دسترسی استاتیک به متغیرهای محیط فراهم می‌کند.
- **راه‌اندازی دایرکتوری**: کلاس `DirectoryInitializer` اطمینان می‌دهد که دایرکتوری‌های مورد نیاز برای لاگ‌ها، اسکرین‌شات‌ها و آپلودها به صورت خودکار ایجاد شوند.

## نحوه استفاده
### تنظیم وب‌هوک
اسکریپت `setWebhook.php` را برای ثبت وب‌هوک تلگرام اجرا کنید:
```bash
php webhook/setWebhook.php
```
این وب‌هوک را به `api.php` با توکن رمز مشخص شده تنظیم می‌کند.

### دسترسی به داشبورد
- به `viewer/log-viewer.php` در مرورگر خود بروید.
- با استفاده از رمز عبور تعریف شده در `log-viewer.php` (هش پیش‌فرض: `$2y$12$Y`) وارد شوید.
- داشبورد موارد زیر را نمایش می‌دهد:
  - دستورات تکمیل شده، در حال انتظار و ناموفق
  - داده‌های کلاینت (کلیدهای تایپ شده، اطلاعات سیستم، اسکرین‌شات‌ها)
  - وضعیت تشخیص VM
  - رمزهای وای‌فای
  - جزئیات اتصالات RDP
- از نماهای مدال برای بررسی لاگ‌های دقیق و دانلود داده‌ها استفاده کنید.

### تعامل از طریق تلگرام
- از ربات تلگرام برای صدور دستورات به کلاینت‌ها استفاده کنید.
- دستورات پشتیبانی شده شامل:
  - `/start`: لیست کلاینت‌های موجود
  - `/select <client_id>`: انتخاب یک کلاینت برای صدور دستورات
  - `/status`, `/screenshot`, `/upload`, `/exec`, و غیره (برای لیست کامل به `CallbackQueryHandler.php` مراجعه کنید)
- فقط ادمین (تعریف شده توسط `ADMIN_CHAT_ID`) می‌تواند دستورات را صادر کند.

## ملاحظات امنیتی
- **رمزنگاری**: داده‌های حساس با استفاده از AES-256-CBC و کلید مشخص شده در `.env` رمزنگاری می‌شوند.
- **احراز هویت**: داشبورد نیاز به رمز عبور دارد (هش شده در `log-viewer.php`). متغیر `$stored_hash` را با یک هش رمز عبور امن به‌روزرسانی کنید.
- **HTTPS**: اطمینان حاصل کنید که سرور از HTTPS برای محافظت از ارتباطات وب‌هوک و API استفاده می‌کند.
- **مجوزهای فایل**: دسترسی به فایل `.env` و دایرکتوری‌های لاگ را محدود کنید تا از دسترسی غیرمجاز جلوگیری شود.
- **رمز وب‌هوک**: از یک `WEBHOOK_SECRET` قوی برای اعتبارسنجی درخواست‌های تلگرام استفاده کنید.
- **امنیت پایگاه داده**: از یک کاربر اختصاصی پایگاه داده با حداقل مجوزها استفاده کنید.

## طرح پایگاه داده
پایگاه داده (`logger`) شامل جداول زیر است:
- `command_logs`: ذخیره لاگ‌های دستورات تلگرام با شناسه‌های چت و کاربر.
- `users`: مدیریت احراز هویت کاربران و وضعیت ادمین.
- `clients`: ردیابی اطلاعات کلاینت (شناسه، IP، وضعیت آنلاین).
- `client_commands`: صف‌بندی و ردیابی دستورات کلاینت با وضعیت و نتایج.
- `user_data`: ذخیره داده‌های ارسالی توسط کلاینت (کلیدهای تایپ شده، اطلاعات سیستم، اسکرین‌شات‌ها).
- `client_vm_status`: ثبت نتایج تشخیص VM.
- `client_wifi_data`: ذخیره داده‌های شبکه وای‌فای.
- `client_logs`: لاگ‌های عمومی برای فعالیت‌های کلاینت (مانند خود-تخریبی، به‌روزرسانی‌ها).
- `user_selections`: ردیابی کلاینت‌های انتخاب شده برای کاربران تلگرام.

اسکریپت `database-installer/install-db.php` را برای ایجاد این جداول و راه‌اندازی کاربر ادمین اجرا کنید.

## مشارکت
مشارکت‌ها استقبال می‌شوند! لطفاً این مراحل را دنبال کنید:
1. مخزن را فورک کنید.
2. یک شاخه ویژگی ایجاد کنید (`git checkout -b feature/your-feature`).
3. تغییرات خود را کامیت کنید (`git commit -m "Add your feature"`).
4. به شاخه خود push کنید (`git push origin feature/your-feature`).
5. یک درخواست pull باز کنید.

## مجوز
این پروژه تحت مجوز MIT منتشر شده است. برای جزئیات به فایل `LICENSE` مراجعه کنید.
توسط  فرهام اقدسی